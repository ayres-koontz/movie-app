<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Movies</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
          crossorigin="anonymous">
    <link rel="stylesheet" href="movies-app-style.css">

</head>

<body>

<header>

    <h2>Movies</h2>

</header>

<!--Added this container class from bootstrap to pull away from the edges.-->
<!--Also, to not get above mixed up with the same id, I changed the id to 'contain'-->
<section class="container">

    <!--    I tried looking - what is below for? I commented it out for now-->
    <!--<h2 id="movieTitle"></h2>-->

    <div id="contain"></div>

</section>
<!--Added form below-->
<section class="container">
    <form>
        <div class="form-group">
            <label for="new-movie">Add New Movie</label>
            <input type="text" class="form-control autocomplete" id="new-movie"
                   placeholder="Movie Name">
        </div>
        <div class="form-group">
            <label for="new-rating">Rating</label>
            <select class="form-control" id="new-rating">
                <option>5</option>
                <option>4</option>
                <option>3</option>
                <option>2</option>
                <option>1</option>
            </select>
        </div>
        <button type="submit" id="submit-new" class="btn">Submit</button>
    </form>
</section>

<script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

<script src="js/movie-app.js"></script>

<!--Added the card class and buttons for edit and delete.-->
<!--Will need to sync those actions based off the ids given to each.-->
<script>
    //---------------------------------------------------------------------------------------------
    //Function to populate the movies on the page:
    // ** Added a data-index-number that gets its value from
    //    the movie id so that we can bind it to the delete function.

    function populateMovies() {
        getMovies().then((movies) => {
            let movieHTML = '';
            movies.forEach(({id, title, rating}) => {
                movieHTML = `<div class="card card-style"><h1>${title}</h1><p>Rating: ${rating}</p>
                        <span><button type="submit" data-index-number=${id} id="submit-edit" class="btn">Edit</button>
                        <button type="submit" data-index-number=${id} id="submit-delete" class="btn">Delete</button></span></div>`;
                $('#contain').append(movieHTML)
            })
        })
    }

    populateMovies();
//-------------------------------------------------------------------------------------------------
    //Adding functionality to the Delete button:
    // *** Because we are adding events to elements that only exist after the promise is returned,
    //     we have to use EVENT DELEGATION. (https://stackoverflow.com/questions/203198/event-binding-on-dynamically-created-elements)

    $(document).on("click", "#submit-delete", function () {
        let movieIndex = $(this).attr("data-index-number");
        let confirmDelete = confirm(`Are you sure you want to delete this movie?`)
        if (confirmDelete) {
            deleteMovie(movieIndex);
            $('#contain').empty();// Empties out the contain div so it can be repopulated
        }
        populateMovies(); //repopulates the contain div
    })

//-------------------------------------------------------------------------------------------------
    // Have to use event delegation here too
    $(document).on("click", "#submit-edit", function (e){
        e.preventDefault();
        let movieIndex = $(this).attr("data-index-number");
        // console.log(movieIndex);
        let newName = prompt("What is the name of the movie?")
        // console.log(newName);
        let newRating = prompt("Rate the movie 1-5")
        // console.log(newRating);
        let editedData = {id: movieIndex, title: newName, rating: newRating}; // This is to format the user input
        // console.log(editedData)                                            // to fit into the editMovie function
        let confirmEdit = confirm("Are you sure you want to make these changes?");
        if (confirmEdit) {
            editMovie(editedData);
            $('#contain').empty();
        }
        populateMovies();
    })

</script>

</body>
</html>